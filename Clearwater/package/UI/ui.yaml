#  Licensed under the Apache License, Version 2.0 (the "License"); you may
#  not use this file except in compliance with the License. You may obtain
#  a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
#  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
#  License for the specific language governing permissions and limitations
#  under the License.

Version: 2.2

Templates:
  customJoinNet:
    - ?:
        type: io.murano.resources.ExistingNeutronNetwork
      internalNetworkName: $.instanceConfiguration.network[0]
      internalSubnetworkName: $.instanceConfiguration.network[1]

Application:
  ?:
    type: com.mirantis.clearwater.Clearwater
  instanceTemplate:
    ?:
      type: io.murano.resources.LinuxMuranoInstance
    name: anything
    flavor: $.instanceConfiguration.flavor
    image: $.instanceConfiguration.osImage
    keyname: $.instanceConfiguration.keyPair
    availabilityZone: $.instanceConfiguration.availabilityZone
    assignFloatingIp: true
    networks:
      useEnvironmentNetwork: $.instanceConfiguration.network[0]=null
      useFlatNetwork: false
      customNetworks: switch($.instanceConfiguration.network[0], $=null=>list(), $!=null=>$customJoinNet)
  dnsApp: $.appConfig.dnsServer
  bonoClusterSize: $.appConfig.bonoClusterSize
  sproutClusterSize: $.appConfig.sproutClusterSize
  homerClusterSize: $.appConfig.homerClusterSize
  homesteadClusterSize: $.appConfig.homesteadClusterSize

Forms:
  - instanceConfiguration:
      fields:
        - name: keypair
          type: keypair
          label: keypair
          description: >-
            Select the Key Pair to control access to instances. You can login to
            instances using this KeyPair after the deployment of application.
          required: false
        - name: flavor
          type: flavor
          label: Instance flavor
          description: >-
            Select registered in Openstack flavor. Consider that application performance
            depends on this parameter.
        - name: osImage
          type: image
          label: Instance image
          imageType: linux
          description: >-
            Select valid Ubuntu 14.04 image with cloud-init preinstalled for the application.
            Image should already be prepared and registered in glance.
        - name: availabilityZone
          type: azone
          label: Availability zone
          description: Select availability zone where application would be installed.
          required: false
        - name: network
          type: network
          label: Network
          description: Select a network to join. 'Auto' corresponds to a default environment's network.
          required: false
          murano_networks: translate

  - appConfig:
      fields:
        - name: dnsServer
          type: com.mirantis.network.dns.Bind
          label: DNS server
          description: >-
            Add internal DNS server application. DNS is used by Clearewater to refer to its nodes

        - name: bonoClusterSize
          type: integer
          label: Bono cluster size
          initial: 1
        - name: sproutClusterSize
          type: integer
          label: Sprout cluster size
          initial: 1
        - name: homerClusterSize
          type: integer
          label: Homer cluster size
          initial: 1
        - name: homesteadClusterSize
          type: integer
          label: Homestead cluster size
          initial: 1